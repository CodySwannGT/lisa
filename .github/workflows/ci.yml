name: ğŸ” CI Quality Checks

on:
  pull_request:
  workflow_dispatch:

jobs:
  quality:
    name: ğŸ” Quality Checks
    timeout-minutes: 30
    # Reference to the quality checks workflow
    uses: ./.github/workflows/quality.yml
    with:
      node_version: '22.21.1'
      package_manager: 'bun'
      skip_jobs: 'test,test:integration,test:e2e'
    secrets: inherit

  # playwright:
  #   name: ğŸ­ Playwright Tests
  #   timeout-minutes: 30
  #   needs: [quality]
  #   uses: ./.github/workflows/playwright.yml
  #   with:
  #     pr_number: ${{ github.event.pull_request.number }}
  #     branch_ref: ${{ github.head_ref }}
  #     base_ref: ${{ github.base_ref }}

  lighthouse:
    name: ğŸ’¡ Lighthouse CI
    timeout-minutes: 15
    needs: [quality]
    uses: ./.github/workflows/lighthouse.yml
    with:
      node_version: '22.21.1'
      package_manager: 'bun'

  create_issue_on_failure:
    name: ğŸ“Œ Create Issue on Failure
    timeout-minutes: 5
    needs: [quality]
    if: ${{ always() && (needs.quality.result == 'failure' || needs.quality.result == 'failure') && !contains(github.event.head_commit.message, '[skip ci]') }}
    uses: ./.github/workflows/create-issue-on-failure.yml
    with:
      workflow_name: 'CI Quality Checks'
      failed_job: ${{ needs.quality.result == 'failure' && 'quality' || 'playwright' }}
    secrets: inherit
